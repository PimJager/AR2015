\documentclass[12pt]{article}
\usepackage{a4wide}
\usepackage{latexsym}
\usepackage{amssymb}
\usepackage{epic}
\usepackage{graphicx}
\usepackage{amsmath}
\usepackage{enumerate}
\usepackage{listings}
\usepackage{float}
\usepackage{multirow}
%\pagestyle{empty}
\newcommand{\tr}{\mbox{\sf true}}
\newcommand{\fa}{\mbox{\sf false}}
\newcommand{\bimp}{\leftrightarrow}

\lstset{ keepspaces=true
        ,captionpos=b
        ,basicstyle=\scriptsize\ttfamily
        ,escapechar=§}

\begin{document}

\section*{Automated Reasoning - Assignment series 2 }

\begin{center}
P.T. Jager, BSc. \\
Radboud universiteit Nijmegen\\
email: {\tt p.jager@student.ru.nl}
\end{center}

\subsection*{Problem 2: Bottles}

Three bottles can hold 144, 72 and 16 units (say, centiliters), respectively.
Initially the first one contains 3 units of water, the others are empty. 
The following actions may be performed any number of times:

\begin{itemize}
    \item One of the bottles is fully filled, at some water tap.
    \item One of the bottles is emptied.
    \item The content of one bottle is poured into another one. If it fits, 
            then the full content is poured, otherwise the pouring stops when 
            the other bottle is full.
\end{itemize}

\begin{enumerate}[(a)]
    \item Determine whether it is possible to arrive at a situation in which 
    the first bottle contains 8 units and the second one contains 11 units. If 
    so, give a scenario reaching this situation.
    \item Do the same for the variant in which the second bottle is replaced by 
    a bottle that can hold 80 units, and all the rest remains the same.
    \item Do the same for the variant in which the third bottle is replaced by a
    bottle that can hold 28 units, and all the rest (including the capacity of 
    72 of the second bottle) remains the same.
\end{enumerate}

\subsubsection*{Model}
The problem can trivially be modeled as LTL for NuSMV. The equations below are 
written in a quantified pseudo language which resembles NuSMVs syntax and by 
expanding the quantifiers can be expanded to a NuSMV program. 

\vspace{1mm}

The amount of water in each bottle is modeled using a variable $c_{xn}$ where 
$x$ is the number of the bottle and $n$ counts the timesteps. The value of 
$c_{xn}$ ranges 
from the bottle being empty (0) to the bottle begin at max capacity, for this we
assume a function $max(x)$ which yields the maximum capacity of the bottle 
$x$, i.e. $max(1) = 144$.

And for all these contents the initial value has to be set, for this we assume
a function $init(x)$ which yields the initial contents of the bottle $x$, i.e. 
$init(1) = 3$.
\begin{align*}
        &\forall_{x \in \{1,2,3\}} c_{xn} : 0 \ldots max(x) \\  
        &\bigwedge_{x \in \{1,2,3\}} c_{x0} = init(x)
\end{align*}

\vspace{3mm}

The following transition function defines that at each timestep one of the three
actions described above could be done to one of the three bottles:
\begin{align*}
    \bigvee_{x \in \{1,2,3\}} &  \\  
            &\left( 
                (c_{x(n+1)} = max(x) \vee x_{x(n+1)} = 0) 
                    \wedge 
                    \left(\bigwedge_{y \in \{1,2,3\} \setminus \{x\}} 
                        c_{y(n+1)} = c_{yn}\right)
             \right) \\  
             &\vee \\  
             &\bigvee_{y \in \{1,2,3\} \setminus \{x\}} 
                \Big(\\  
                    &case\\  
                    &c_{xn} + x_{yn} \leq max(x) \to 
                        c_{x(n+1)} = (c_{xn} + x_{yn}) \wedge c_{y(n+1)} = 0 
                            \wedge \bigwedge_{z \in \{1,2,3\} \setminus \{x,y\}}
                                c_{z(n+1)} = c_{zn}\\  
                    &otherwise  \to
                        c_{x(n+1)} = max(x) \wedge 
                        c_{y(n+1)} = c_{yn} - (max(x) - c_{xn}) \wedge 
                        \bigwedge_{z \in \{1,2,3\} \setminus \{x,y\}}
                            c_{z(n+1)} = c_{zn}\\  
                    &esac\\  
                \Big)
\end{align*}

\vspace{3mm}

To find if it is possible to reach the desired bottle contents we ask NuSMV to 
prove that the this desired state is never reached. That is, the following 
formula should hold for every n (globally).
\begin{equation} \label{eq:ltlspec}
    \neg (c_{1n} = 8 \wedge c_{2n} = 11)
\end{equation}
If NuSMV finds a sequence that violates this formula, and thus reaches our
desired state, it will show this sequence. 

\subsubsection*{solution (a)}
If we specify the $max(x)$ as follows:
\begin{equation*}
max(x) = 
    \begin{cases}
        144 & x = 1\\  
        72  & x = 2\\  
        16  & x = 3\\  
    \end{cases}
\end{equation*}
NuSMV indeed finds a sequence that shows that it is possible to have 8 units in 
bottle 1 and 11 units in bottle 2 in under second. This sequence is shown
in the table below.

\begin{tabular}{|l|l|l|l|}
    \hline  
    n & bottle 1    & bottle 2  & bottle 3  \\  
    \hline \hline
    1 & 3   & 0     & 0 \\  
    2 &     & 72    &   \\  
    3 & 75  & 0     &   \\      
    4 & 59  &       & 16 \\  
    5 &     & 16    & 0 \\  
    6 & 43  &       & 16 \\  
    7 &     & 32    &   \\  
    8 & 27  &       &   \\  
    9 &     & 48    & 0 \\  
    10&     &       & 16 \\  
    11&     & 64    & 0 \\  
    12& 11  &       & 16 \\  
    13&     & 72    & 8 \\  
    14&     & 0     &   \\  
    15& 0   & 11    &   \\  
    16& 8   &       & 0 \\  
    \hline
      & 8   & 11    & 0 \\  
    \hline
\end{tabular}

\subsubsection*{Solution (b)}
Similar to (a) we define the $max(x)$ function as follows:
\begin{equation*}
max(x) = 
    \begin{cases}
        144 & x = 1\\  
        80  & x = 2\\  
        16  & x = 3\\  
    \end{cases}
\end{equation*}
NuSMV determines in under a seconds that our specification is true. That is, 
formula~\ref{eq:ltlspec} holds for every $n$ and it is not possible to have the 
desired amounts in bottle 1 and 2.

\subsubsection*{Solution (c)}
Similar to (a) we define the $max(x)$ function as follows:
\begin{equation*}
max(x) = 
    \begin{cases}
        144 & x = 1\\  
        72  & x = 2\\  
        28  & x = 3\\  
    \end{cases}
\end{equation*}
NuSMV finds a sequence that shows our specification is false, thus that is it is
possible to reach the desired state, in just over a second. The table below 
shows this sequence.

\begin{tabular}{|l|l|l|l|}
    \hline  
    n & bottle 1    & bottle 2  & bottle 3  \\  
    \hline \hline
    1 & 3   & 0     & 0 \\  
    2 & 0   & 3     &   \\  
    3 & 144 &       &    \\  
    4 & 116 &       & 28 \\  
    5 &     & 31    & 0 \\  
    6 & 88  &       & 28 \\  
    7 &     & 59    & 0 \\  
    8 & 60  &       & 28 \\  
    9 &     & 72    & 15 \\  
    10& 143 &       & 0 \\  
    11&     & 15    & 0 \\  
    12& 104 &       & 28 \\  
    13&     & 43    & 0 \\  
    14& 76  &       & 28 \\  
    15&     & 71    & 0 \\  
    16& 48  &       & 28 \\
    17&     & 72    & 27 \\  
    18& 120 & 0     &  \\  
    19&     & 27    & 0 \\  
    20& 92  &       & 28 \\  
    21&     & 55    & 0 \\  
    22& 64  &       & 28 \\  
    23&     & 72    & 11 \\  
    24&     & 0     &   \\  
    25&     & 11    & 0 \\  
    26& 36  &       & 28 \\  
    27&     &       & 0 \\  
    28& 8   &       & 28 \\  
    \hline
      & 8   & 11    & 28 \\  
    \hline
\end{tabular}

\subsubsection*{3. Groups and Rewriting}
% https://www.cs.unm.edu/~mccune/prover9/manual/Dec-2007/output.html
\paragraph{(a)} 
\textit{In mathematics, a group is defined to be a set $G$ with an 
element $I \in G$, a binary operator $∗$ and a unary operator $inv$ satisfying 
four group laws.} \footnote{see the original problem description for a listing
of the four laws.}

\textit{Determine if the following four properties hold, and if not 
determine the size of the smallest finite group for which it does not hold.}

\vspace{3mm}

We use Prover9 and Mace4 to construct our proofs or counter examples. The four
laws are trivially written as \emph{assumptions} in the syntax (taking care
that all elements referenced in the law are universally quantified using the 
\texttt{all} keyword.).

\vspace{3mm}

\begin{equation*}
    I * x = x
\end{equation*}
This property is trivially written in the syntax (once again, taking care to 
universally quantify $x$). Prover9 finds a proof by contradiction: 

\begin{lstlisting}
1  (all x all y all z x * (y * z) = (x * y) * z)    [assumption].§\footnotemark§ 
§\footnotetext{
More on the meaning of the justification (the part between square brackets) can
be found on the Prover9 website: 
https://www.cs.unm.edu/~mccune/prover9/manual/Dec-2007/output.html under
`Clause Justification'.}§
2  (all x x * I = x)                                [assumption].
3  (all x x * inv(x) = I)                           [assumption].
4  (all x I * x = x)                                [goal].
8  (x * y) * z = x * (y * z).                       [clausify(1)].
9  x * I = x.                                       [clausify(2)].
10 x * inv(x) = I.                                  [clausify(3)].
11 I * c1 != c1.                                    [deny(4)].
15 x * (I * y) = x * y.                             [para(9(a,1),8(a,1,1)),flip(a)].
16 x * (inv(x) * y) = I * y.                        [para(10(a,1),8(a,1,1)),flip(a)].
21 I * inv(inv(x)) = x.                             [para(10(a,1),16(a,1,2)),rewrite([9(2)]),flip(a)].
23 x * inv(inv(y)) = x * y.                         [para(21(a,1),8(a,2,2)),rewrite([9(2)])].
24 I * x = x.                                       [para(21(a,1),15(a,2)),rewrite([23(5),15(4)])].
25 $F.§\footnotemark§                                              [resolve(24,a,11,a)].
§\footnotetext{\texttt{\$F} means False in Prover9.}§
\end{lstlisting}

\vspace{3mm}

\begin{equation*}
    inv(inv(x)) = x
\end{equation*}
This property is trivially written in the syntax (once again, taking care to 
universally quantify $x$). Prover9 finds a proof by contradiction:

\begin{lstlisting}
1  (all x all y all z x * (y * z) = (x * y) * z)    [assumption].
2  (all x x * I = x)                                [assumption].
3  (all x x * inv(x) = I)                           [assumption].
5  (all x inv(inv(x)) = x)                          [goal].
8  (x * y) * z = x * (y * z).                       [clausify(1)].
9  x * I = x.                                       [clausify(2)].
10 x * inv(x) = I.                                  [clausify(3)].
12 inv(inv(c2)) != c2.                              [deny(5)].
15 x * (I * y) = x * y.                             [para(9(a,1),8(a,1,1)),flip(a)].
16 x * (inv(x) * y) = I * y.                        [para(10(a,1),8(a,1,1)),flip(a)].
21 I * inv(inv(x)) = x.                             [para(10(a,1),16(a,1,2)),rewrite([9(2)]),flip(a)].
23 x * inv(inv(y)) = x * y.                         [para(21(a,1),8(a,2,2)),rewrite([9(2)])].
24 I * x = x.                                       [para(21(a,1),15(a,2)),rewrite([23(5),15(4)])].
28 x * (inv(x) * y) = y.                            [back_rewrite(16),rewrite([24(5)])].
32 inv(inv(x)) = x.                                 [para(10(a,1),28(a,1,2)),rewrite([9(2)]),flip(a)].
33 $F.                                              [resolve(32,a,12,a)].
\end{lstlisting}

\vspace{3mm}

\begin{equation*}
    inv(x) * x = I
\end{equation*}
This property is trivially written in the syntax (once again, taking care to 
universally quantify $x$). Prover9 finds a proof by contradiction:

\begin{lstlisting}
1  (all x all y all z x * (y * z) = (x * y) * z)    [assumption].
2  (all x x * I = x)                                [assumption].
3  (all x x * inv(x) = I)                           [assumption].
5  (all x inv(inv(x)) = x)                          [goal].
8  (x * y) * z = x * (y * z).                       [clausify(1)].
9  x * I = x.                                       [clausify(2)].
10 x * inv(x) = I.                                  [clausify(3)].
12 inv(inv(c2)) != c2.                              [deny(5)].
15 x * (I * y) = x * y.                             [para(9(a,1),8(a,1,1)),flip(a)].
16 x * (inv(x) * y) = I * y.                        [para(10(a,1),8(a,1,1)),flip(a)].
21 I * inv(inv(x)) = x.                             [para(10(a,1),16(a,1,2)),rewrite([9(2)]),flip(a)].
23 x * inv(inv(y)) = x * y.                         [para(21(a,1),8(a,2,2)),rewrite([9(2)])].
24 I * x = x.                                       [para(21(a,1),15(a,2)),rewrite([23(5),15(4)])].
28 x * (inv(x) * y) = y.                            [back_rewrite(16),rewrite([24(5)])].
32 inv(inv(x)) = x.                                 [para(10(a,1),28(a,1,2)),rewrite([9(2)]),flip(a)].
33 $F.                                              [resolve(32,a,12,a)].
\end{lstlisting}

\vspace{3mm}

\begin{equation*}
    x * y = y * x
\end{equation*}
Prover9 can't find a proof for this. Running the same file through Mace4 gives 
counterexample listed below:

\begin{table}[H]  \centering % size 6
G: \{0,1,2,3,4,5\} \hspace{.5cm}
\begin{tabular}{r|rrrrrr}
inv: & 0 & 1 & 2 & 3 & 4 & 5\\
\hline
   & 0 & 1 & 2 & 4 & 3 & 5
\end{tabular} \hspace{.5cm}
\begin{tabular}{rr|rrrrrr}
& & \multicolumn{6}{c}{x} \\  
& *: & 0 & 1 & 2 & 3 & 4 & 5\\
\hline
\multirow{6}{*}{y} & 0 & 0 & 1 & 2 & 3 & 4 & 5 \\
     & 1 & 1 & 0 & 3 & 2 & 5 & 4 \\
     & 2 & 2 & 4 & 0 & 5 & 1 & 3 \\
     & 3 & 3 & 5 & 1 & 4 & 0 & 2 \\
     & 4 & 4 & 2 & 5 & 0 & 3 & 1 \\
     & 5 & 5 & 3 & 4 & 1 & 2 & 0
\end{tabular}
\caption{ }
\end{table} 

\paragraph{(b)} 
\textit{A term rewrite system consists of the single rule
$$a(x,a(y,a(z,u)))\rightarrow a(y,a(z,a(x,u))),$$
in which $a$ is a binary symbol and $x,y,z,u$ are variables.
Moreover, there are constants $b,c,d,e,f,g$. Determine whether
$c$ and $d$ may swapped in $a(b,a(c,a(d,a(e,a(f,a(b,g))))))$ by
rewriting, that is, $a(b,a(c,a(d,a(e,a(f,a(b,g))))))$ rewrites
in a finite number of steps to
$a(b,a(d,a(c,a(e,a(f,a(b,g))))))$.}

\vspace{3mm}

The problem is trivially written in the Prover9 syntax (once again, taking care
of universal quantification of x, y and z) and Prover9 finds the following 
proof by contradiction:

\begin{lstlisting}
1  (all x all y all z all u a(x,a(y,a(z,u))) = a(y,a(z,a(x,u))))        [assumption].
2  a(b,a(c,a(d,a(e,a(f,a(b,g)))))) = a(b,a(d,a(c,a(e,a(f,a(b,g))))))    [goal].
3  a(x,a(y,a(z,u))) = a(z,a(x,a(y,u))).                                 [clausify(1)].
4  a(b,a(d,a(c,a(e,a(f,a(b,g)))))) != a(b,a(c,a(d,a(e,a(f,a(b,g)))))).  [deny(2)].
5  a(x,a(y,a(z,a(u,a(w,v5))))) = a(u,a(x,a(y,a(w,a(z,v5))))).           [para(3(a,1),3(a,1,2,2))].
13 a(b,a(c,a(d,a(e,a(f,a(b,g)))))) != a(b,a(d,a(c,a(b,a(e,a(f,g)))))).[para(3(a,1),4(a,1,2,2,2)),flip(a)].
62 a(x,a(y,a(z,a(u,a(w,a(v5,v6)))))) = a(v5,a(x,a(z,a(y,a(u,a(w,v6)))))).[para(5(a,1),5(a,1,2))].
79 a(d,a(b,a(c,a(e,a(f,a(b,g)))))) != a(b,a(d,a(c,a(b,a(e,a(f,g)))))).  [para(3(a,1),13(a,1))].
\end{lstlisting}


\end{document}
